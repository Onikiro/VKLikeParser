@{
    Layout = "~/Views/Shared/_AuthorizationLayout.cshtml";
    ViewBag.Title = "Auth...";
}

<script>
    var hash = window.location.hash;
    var tokenPattern = /access_token=([aA-zZ\d]+)/g;
    var expiresPattern = /expires_in=(\d+)/g;
    var userPattern = /user_id=(\d+)/g;
    var token, expires, userId;

    token = GetMatch(hash, tokenPattern);
    expires = GetMatch(hash, expiresPattern);
    userId = GetMatch(hash, userPattern);
    window.location = "ReceiveToken?token=" + token + "&expiresIn=" + expires + "&userId=" + userId;

    function GetMatch(hash, pattern) {
        var match;
        while ((match = pattern.exec(hash))) {
            if (match[1] !== null) {
                return match[1];
            }
        }
        return null;
    }
</script>